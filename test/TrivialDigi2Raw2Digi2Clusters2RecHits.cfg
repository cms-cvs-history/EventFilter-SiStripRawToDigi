
process TrivialDigi2Raw2Digi2Clusters2RecHits = 
{
    # message logger
    include "DQM/SiStripCommon/data/MessageLogger.cfi"
    replace MessageLogger.cout.threshold = "INFO"
    replace MessageLogger.cerr.threshold = "INFO"
    replace MessageLogger.error.threshold = "INFO"
    replace MessageLogger.event.threshold = "INFO"
    replace MessageLogger.debug.threshold = "INFO"
    
    # initialize magnetic field
    include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

    # trivial source
    include "IORawData/SiStripInputSources/data/EmptySource.cff"
    include "EventFilter/SiStripRawToDigi/test/data/SiStripTrivialClusterSource.cfi"
    replace maxEvents.input = 500
    
    # event data
    include "Geometry/TrackerRecoData/data/trackerRecoGeometryXML.cfi"
    include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
    include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
    include "CondCore/DBCommon/data/CondDBSetup.cfi"
    include "HLTrigger/Configuration/data/rawToDigi/SiStripDBCabling.cfi"
    include "CalibTracker/SiStripConnectivity/data/SiStripConnectivity.cfi"

    # digi-to-raw
    include "EventFilter/SiStripRawToDigi/data/DigiToRaw.cfi"
    replace DigiToRaw.InputModuleLabel = "ClusterSource"  
    replace DigiToRaw.FedReadoutMode = "ZERO_SUPPRESSED" 
    
    # raw-to-digi
    include "EventFilter/SiStripRawToDigi/data/SiStripDigis.cfi"
    replace SiStripDigis.ProductLabel = "DigiToRaw"

    # digi-to-clusters
    include "CalibTracker/Configuration/data/SiStrip_FakeGain.cff"
    include "CalibTracker/Configuration/data/SiStrip_FakeNoise.cff"
    include "CalibTracker/Configuration/data/SiStrip_FakePedestals.cff"
    include "RecoLocalTracker/SiStripClusterizer/data/SiStripClusterizer.cfi"
    replace siStripClusters.DigiProducersList = 
    {
	{ 
	    string DigiProducer = "SiStripDigis"
	    string DigiLabel    = "ZeroSuppressed"
	}
    }

    # clusters-to-rechits
    include "CalibTracker/SiStripLorentzAngle/data/SiStripLAFakeESSource.cfi"
    include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"
    include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitMatcher.cfi"
    include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi"
    replace siStripMatchedRecHits.ClusterProducer = "siStripClusters"

    # path
    path p = {ClusterSource, DigiToRaw, SiStripDigis, siStripClusters, siStripMatchedRecHits}

    # performance
    service = PathTimerService {}
    include "CalibTracker/SiStripConnectivity/data/SiStripRegionConnectivity.cfi"
    include "SimGeneral/HepPDTESSource/data/pythiapdt.cfi" 

    module perf1 = Performance from "EventFilter/SiStripRawToDigi/test/data/SiStripPerformance.cfi"
    replace perf1.FileName = "Trivial_Global.root"
    replace perf1.TreeName = "raw2digis"
    replace perf1.SiStripDigisModuleLabel = "SiStripDigis"
    replace perf1.SiStripDigisProductLabel = "ZeroSuppressed"
    replace perf1.SiStripClustersModuleLabel = "siStripClusters"
    replace perf1.UnpackingModuleLabels = {"SiStripDigis"}

    module perf2 = Performance from "EventFilter/SiStripRawToDigi/test/data/SiStripPerformance.cfi"
    replace perf2.FileName = "Trivial_Global2.root"
    replace perf2.TreeName = "raw2clusters"
    replace perf2.SiStripDigisModuleLabel = "SiStripDigis"
    replace perf2.SiStripDigisProductLabel = "ZeroSuppressed"
    replace perf2.SiStripClustersModuleLabel = "siStripClusters"
    replace perf2.UnpackingModuleLabels = {"SiStripDigis","siStripClusters"}

    module perf3 = Performance from "EventFilter/SiStripRawToDigi/test/data/SiStripPerformance.cfi"
    replace perf3.FileName = "Trivial_Global3.root"
    replace perf3.TreeName = "raw2rechits"
    replace perf3.SiStripDigisModuleLabel = "SiStripDigis"
    replace perf3.SiStripDigisProductLabel = "ZeroSuppressed"
    replace perf3.SiStripClustersModuleLabel = "siStripClusters"
    replace perf3.UnpackingModuleLabels = {"SiStripDigis","siStripClusters","siStripMatchedRecHits"}

    endpath performance = {perf1,perf2,perf3}
}
